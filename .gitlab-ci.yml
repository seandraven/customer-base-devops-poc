stages:
  - deploy

variables:
  DEPLOY_ENVIRONMENT:
    value: "development"
    description: "The deployment target.Change to qa o production"

deploy:
  image: plcom/gcloud-node
  stage: deploy
  tags:
    - docker-keo-runner
  environment: $DEPLOY_ENVIRONMENT
  script:
    - npx gae-ayaml-env
    - gcloud auth activate-service-account --key-file $GOOGLE_SERVICE_ACCOUNT_FILE
    - gcloud app deploy app.yaml --quiet --project $GOOGLE_PROJECT_ID --version 1
  rules:
    - when: manual
